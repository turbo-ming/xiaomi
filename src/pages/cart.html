<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/cart.css">
</head>

<body>
    <table class="shop">
        <tbody class="shopS">
            <tr class="nav">
                <th class="Son1">商品名称</th>
                <th class="Son2">数量</th>
                <th class="Son3">单价</th>
                <th class="Son4">小计</th>
                <th class="Son5">操作</th>
            </tr>
            <!-- <tr class="shopList">
                  <td class="imgTd"><img class="shops" src="../images/vans.jpg" alt="" srcset=""></td>
                <td class="titleTd">
                    <h6>Vans范斯 经典系列 Old Skool板鞋运动鞋 低帮经典款男女官方正品</h6>
                    <span>ID:#2001</span>
                    <span>Size:37</span>
                </td>
                <td class="Son2">
                    <span class="reduce">-</span>
                    <input type="text" value="1" class="count">
                    <span class="add">+</span>
                </td>
                <td class="Son3">
                    <del class="oriPrice">399.99 py6</del>
                    <b class="nowPrice">299.98 py6</b>
                </td>
                <td class="Son4">
                    <span class="priceAll">399.99 py6</span>
                    <span class="saveAll">You save 100.01 py6</span>
                </td>
                <td class="Son5">
                    <img class="del" src="../images/del.png" alt="">
                </td>
            </tr>-->
            <tfoot>
                <tr class="countall">
                    <td class="back"> <a href="./index11.html">继续购物</a></td>
                    <td class="countRight">
                        <span>合计:  <b class="sum">1929.45 元</b></span>

                    </td>
                    <td class="Total"><button>去结算</button></td>
                </tr>

            </tfoot>
        </tbody>

    </table>






    <script src="../lib/jquery/jquery.min.js"></script>
    <script>
        cart();

        function cart() {
            $.ajax({
                url: '../lib/cart.json',
                dataType: 'json',
                success: function(res) {
                    // console.log(res);
                    let str = '';
                    res.forEach(item => {
                            str += `
                    <tr class="shopList">
                    <td class="imgTd"><img class="shops" src=${item.url} alt="" srcset=""></td>
                    <td class="titleTd">
                        <h6>${item.title}</h6>
 
                    </td>
                    <td class="Son2">
                        <span class="reduce">-</span>
                        <input type="text" value="1" class="count">
                        <span class="add">+</span>
                    </td>
                    <td class="Son3">

                         <b class="nowPrice">${item.price} 元</b>
                     </td>
                     <td class="Son4">
                         <span class="priceAll">${item.Total} 元</span>
                      
                     </td>
                     <td class="Son5">
                         <img class="del" src="../images/del.png" alt="">
                     </td>
                     </tr>
                    `
                        })
                        //填充
                    var tbody = document.querySelector(".shopS");
                    tbody.innerHTML += str;
                    //渲染成功

                    var nowPrice = document.querySelector(".nowPrice");
                    var del = document.querySelector(".del");
                    var priceAll = document.querySelector(".priceAll");


                    //声明一个变量先不赋值,点击添加,减少商品数量,或者删除的时候在重新赋值,再计算总价
                    var priceAll;
                    var saveAll;



                    var Sum = document.querySelectorAll('.sum')[0],
                        discount = document.querySelectorAll('.discount')[0];



                    tbody.onclick = function(e) {
                            var evt = e.target;


                            if (evt.className == "add") {

                                var saveMoney = (evt.parentNode.nextElementSibling.firstElementChild.innerHTML.split(' ')[0] * 1) - (evt.parentNode.nextElementSibling.lastElementChild.innerHTML.split(' ')[0] * 1);

                                //点击+号时把值重新赋值给上一个兄弟元素，就是input框的value值
                                evt.previousElementSibling.value = evt.previousElementSibling.value * 1 + 1;
                                // console.log(saveMoney.toFixed(2));

                                //现价乘以数量,就是成交交价格
                                evt.parentNode.nextElementSibling.nextElementSibling.firstElementChild.innerHTML = (evt.previousElementSibling.value * evt.parentNode.nextElementSibling.lastElementChild.innerHTML.split(' ')[0]).toFixed(2) + "  元";

                                //当添加商品的时候重新获取 saveAll和priceAll的值，再重新计算总价
                                // saveAll = document.querySelectorAll('.saveAll');
                                priceAll = document.querySelectorAll('.priceAll');

                            } else if (evt.className == "reduce") {

                                if (evt.nextElementSibling.value > 0) {
                                    evt.nextElementSibling.value = evt.nextElementSibling.value * 1 - 1;
                                    evt.parentNode.nextElementSibling.nextElementSibling.firstElementChild.innerHTML = (evt.nextElementSibling.value * evt.parentNode.nextElementSibling.firstElementChild.innerHTML.split(' ')[0]).toFixed(2) + ' 元';

                                    //当减少商品数量的时候,再重新获取saveAll和priceAll的值,再重新计算总价

                                    priceAll = document.querySelectorAll('.priceAll');
                                }
                            }

                            //删除购物车
                            if (evt.className == "del") {
                                // console.log(evt);
                                if (confirm("确定要删除购物车吗？？？？？？？")) {
                                    evt.parentNode.parentNode.remove();

                                    priceAll = document.querySelectorAll('.priceAll');
                                } else {

                                }
                            }

                            //调用封装的函数
                            summary(priceAll, Sum, 0)
                                // summary(saveAll, discount, 2)
                        }
                        //封装总价函数
                    function summary(arr, ele, idx) {
                        var n1 = 0;
                        arr.forEach(function(items) {
                            n1 += (items.innerHTML.split(' ')[idx] * 1);
                        })
                        ele.innerHTML = n1.toFixed(2) + ' 元'
                    }
                }
            })
        }
    </script>
</body>

</html>