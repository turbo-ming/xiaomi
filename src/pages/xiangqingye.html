<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/xaingqingye.css">
    <link rel="stylesheet" href="../icon-font/iconfont.css">
</head>

<body>
    <div id="topWrap">
        <div id="topWrap_cont">
            <section class="top_log">
                <ul class="ul_1">
                    <li>
                        <a href="#">小米商城</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">MIUI</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">loT</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">云服务</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">金融</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">有品</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">小爱开放平台</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">企业团购</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">物质证照</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">协议规则</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">下载APP</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">SelectLocation</a>
                    </li>
                </ul>
                <aside>
                    <h2><i class="iconfont icon-icon-test4"></i>购物车<span>(0)</span></h2>
                </aside>
                <ul class="ul_2">
                    <li>
                        <a href="">登陆</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">注册</a>
                        <span>|</span>
                    </li>
                    <li>
                        <a href="">消息通知</a>
                    </li>
                </ul>
            </section>
            <section class="top_lis">
                <h1></h1>
                <form action="">
                    <input type="text" class="txt" placeholder="小米9...">
                    <button class="sub"><i class="iconfont icon-icon-test5"></i></button>
                </form>
                <ul class="ul_3">
                    <li>
                        <a href="">小米手机</a>
                    </li>
                    <li>
                        <a href="">Redmi 红米</a>
                    </li>
                    <li>
                        <a href="">电视</a>
                    </li>
                    <li>
                        <a href="">笔记本</a>
                    </li>
                    <li>
                        <a href="">家电</a>
                    </li>
                    <li>
                        <a href="">路由器</a>
                    </li>
                    <li>
                        <a href="">智能硬件</a>
                    </li>
                    <li>
                        <a href="">服务</a>
                    </li>
                    <li>
                        <a href="">社区</a>
                    </li>
                </ul>
            </section>
        </div>
    </div>

    <!-- case1 -->
    <div id="case1">
        <div id="case1_cont">
            <div class="left" id="left">
                <!-- <section class="show">
                    <img src="../images/m1.jpg" alt="">
                    <aside class="mask"></aside>
                </section>
                <div class="list">
                    <p class="active" bigImg="../images/m1.jpg" img="../images/m1.jpg">
                        <img src="../images/m1.jpg" alt="">
                    </p>
                    <p bigImg="../images/m2.jpg" img="../images/m2.jpg">
                        <img src="../images/m2.jpg" alt="">
                    </p>
                    <p bigImg="../images/m3.jpg" img="../images/m3.jpg">
                        <img src="../images/m3.jpg" alt="">
                    </p>
                </div>
                <div class="enlarge"></div> -->
            </div>
            <div class="right">
                <div class="top_info">
                    <h2>Redmi K30</h2>
                    <p class="sale_desc" id="J_desc">
                        <font color="#ff4a00">「享小米/花呗6期免息」</font>120Hz高帧率流速屏 / 索尼6400万前后六摄 / 6.67''小孔径全面屏 / 最高可选8GB+256GB大存储 / 高通骁龙730G处理器 / 3D四曲面玻璃机身 / 4500mAh+27W快充 / 多功能NFC
                    </p>
                    <h3>小米自营</h3>
                    <h4>2199元</h4>
                </div>
                <section class="address">
                    <p>
                        <i class="iconfont icon-icon_GPS"></i>
                        <span>广东</span>
                        <span>广州市</span>
                        <span>天河区</span>
                        <span>元岗街道</span>
                        <em>修改</em>
                    </p>
                    <h2>有现货</h2>
                </section>
                <section class="Edition">
                    <h2>选择版本</h2>
                    <aside class="as_1">
                        <p><span>8GB+128GB</span><em>1899元</em></p>
                    </aside>
                    <aside>
                        <p><span>8GB+128GB</span><em>1899元</em></p>
                    </aside>
                    <aside class="as_2">
                        <p><span>8GB+128GB</span><em>1899元</em></p>
                    </aside>
                    <aside>
                        <p><span>8GB+128GB</span><em>1899元</em></p>
                    </aside>
                </section>
                <section class="Buy">
                    <a href="" class="buy">加入购物车</a>
                    <a href="" class="like"></a>
                </section>
            </div>
        </div>
    </div>


    <!-- 发送ajax请求 -->
    <script src="../lib/jquery/jquery.min.js"></script>
    <script>
        getFdj();
        var parmas = location.search.slice(1); //获取id=1
        var id = parmas.split("=")[1] * 1;
        console.log(id);


        function getFdj() {
            $.ajax({
                    url: '../lib/xiangqingye.json',
                    dataType: 'json',
                    success: function(res) {
                        console.log(res);
                        let str = '';

                        let change = res.filter(function(items, index) {
                            return items.id === id;
                            // console.log(items.id); 

                        })[0]
                        console.log(change);

                        console.log(change.Img3);


                        str += `
                        <section class="show">
                    <img src=${change.Img1} alt="">
                    <aside class="mask"></aside>
                </section>
                <div class="list">
                    <p class="active" bigImg=${change.Img1} img=${change.Img1}>
                        <img src=${change.Img1}>
                    </p>
                    <p bigImg=${change.Img2} img=${change.Img2}>
                        <img src=${change.Img2} alt="">
                    </p>
                    <p bigImg=${change.Img3} img=${change.Img3}>
                        <img src=${change.Img3} alt="">
                    </p>
                </div>
                <div class="enlarge"></div>
                        `
                        $('#left').html(str);

                        //渲染成功开始写放大镜功能

                        //  获取非内联样式样式
                        function getStyle(ele, attr) {
                            var style;
                            if (window.getComputedStyle) {
                                // attr 是一个 字符串 对象[字符串]
                                style = window.getComputedStyle(ele)[attr];
                            } else {
                                style = ele.currentStyle[attr];
                            }
                            return style;
                        }
                        class Enlarge {
                            constructor(ele) {
                                this.ele = document.querySelector(ele);
                                this.init();
                            }

                            init() {
                                this.show = this.ele.querySelector('.show');
                                this.mask = this.ele.querySelector('.mask');
                                this.enlarge = this.ele.querySelector('.enlarge');

                                //鼠标移入show盒子，显示mask和enlarge
                                this.show.onmouseover = () => {
                                    this.mask.style.display = this.enlarge.style.display = 'block';
                                    this.setStyle();
                                    this.move();
                                }

                                //鼠标移出隐藏
                                this.show.onmouseout = () => {
                                    this.mask.style.display = this.enlarge.style.display = 'none';
                                }

                                // 获取小图的标签，并且绑定点击事件？
                                this.p = this.ele.querySelector('.list').children;
                                let _this = this;
                                for (let i = 0; i < this.p.length; i++) {
                                    this.p[i].onmouseover = function() {
                                        _this.change(this);
                                    }

                                }
                            }

                            setStyle() {
                                // 设置放大镜盒子的大小
                                // 放大镜盒子的大小 = 遮罩层盒子的大小 * 放大镜盒子背景图的大小 / show盒子的大小

                                // 遮罩层盒子的大小
                                this.maskWidth = this.mask.offsetWidth;
                                this.maskHeight = this.mask.offsetHeight;

                                //放大镜背景的大小
                                this.bgx = parseInt(getStyle(this.enlarge, 'background-size').split(' ')[0]);
                                this.bgy = parseInt(getStyle(this.enlarge, 'background-size').split(' ')[1]);

                                //show的大小
                                this.showWidth = this.show.clientWidth;
                                this.showHeight = this.show.clientHeight;

                                let enlargeX = this.maskWidth * this.bgx / this.showWidth;
                                let enlargeY = this.maskHeight * this.bgy / this.showHeight;

                                this.enlarge.style.width = enlargeX + 'px';
                                this.enlarge.style.height = enlargeY + 'px';

                            }
                            move() {
                                // 改变遮罩层的位置 和 放大镜背景图的位置
                                this.show.onmousemove = (e) => {
                                    let left = e.clientX + document.documentElement.scrollLeft - this.ele.offsetLeft - this.maskWidth / 2 - 50;
                                    let top = e.clientY + document.documentElement.scrollTop - this.ele.offsetTop - this.maskHeight / 2 - 100;

                                    // 边界值的判断
                                    if (left <= 0) {
                                        left = 0;
                                    }
                                    if (top <= 0) {
                                        top = 0;
                                    }
                                    if (left >= this.showWidth - this.maskWidth) {
                                        left = this.showWidth - this.maskWidth;
                                    }
                                    if (top >= this.showHeight - this.maskHeight) {
                                        top = this.showHeight - this.maskHeight
                                    }
                                    // 移动遮罩层
                                    this.mask.style.left = left + 'px';
                                    this.mask.style.top = top + 'px';

                                    // 移动背景图
                                    //  背景图移动的距离 = 背景图 * mask移动距离 / show盒子的大小
                                    let bgPX = this.bgx * left / this.showWidth;
                                    let bgPY = this.bgy * top / this.showHeight;
                                    this.enlarge.style.backgroundPosition = `-${bgPX}px -${bgPY}px`;
                                }
                            }
                            change(ele) {
                                //  排他思想
                                for (let j = 0; j < this.p.length; j++) {
                                    this.p[j].classList.remove('active');

                                }
                                ele.classList.add('active');

                                let bigImg = ele.getAttribute('bigImg') // 放大镜的背景图
                                let img = ele.getAttribute('img'); // show 盒子显示的图片

                                // 获取show盒子下面的img图片
                                this.img = this.show.querySelector('img');

                                // 给show盒子下面的img图片设置src属性的属性值
                                this.img.setAttribute('src', img)
                                this.enlarge.style.backgroundImage = `url(${bigImg})`
                            }
                        }
                        //操作对象
                        new Enlarge('.left')
                    }

                })
                // 请求成功之后执行函数
        }
    </script>
</body>

</html>